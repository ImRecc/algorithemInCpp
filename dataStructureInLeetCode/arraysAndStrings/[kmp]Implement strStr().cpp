//kmpç®—æ³•ï¼Œå¯¹needleè¿›è¡Œé¢„å¤„ç†ï¼Œæ‡’å¾—å¤šè¯´
/*æ™®é€šæ–¹æ³•ï¼š
å°±åƒåœ¨ä¸€æœ¬ä¹¦é‡Œæ‰¾ä¸€å¥è¯ã€‚ä½ ä¸ä¼šèƒŒï¼Œä½ åªèƒ½ä¸€é¡µä¸€é¡µã€ä¸€ä¸ªå­—ä¸€ä¸ªå­—å¾€ä¸‹å¯¹ç…§ã€‚ç´¯æ­»ã€‚

KMP çš„æ–¹æ³•ï¼š
ä½ è®°ä½äº†è¿™å¥è¯é‡Œã€Œè‡ªå·±å’Œè‡ªå·±é‡å¤çš„éƒ¨åˆ†ã€ã€‚
æ¯”å¦‚è¦æ‰¾ "ABABAC"ï¼š

ä½ çŸ¥é“å®ƒå¼€å¤´ "ABA" è·Ÿä¸­é—´ "ABA" é‡å¤äº†ã€‚

æ‰€ä»¥å¦‚æœä½ æ¯”å¯¹åˆ° "ABA" åå‘ç°ä¸‹ä¸€ä¸ªå­—ä¸å¯¹ï¼Œä½ ä¸ç”¨å›åˆ°å¼€å¤´ä¸€ä¸ªå­—ä¸€ä¸ªå­—é‡æ–°æ¯”ï¼Œè€Œæ˜¯ç›´æ¥è·³åˆ°ç¬¬äºŒä¸ª "ABA" å»ç»§ç»­ã€‚

ğŸ‘‰ æ¢æˆæ¯”å–»ï¼š

æ™®é€šåŒ¹é…ï¼šå°±åƒä½ æ‰¾é’¥åŒ™å¼€é—¨ï¼Œå‘ç°é’¥åŒ™ä¸å¯¹ï¼Œå°±è¦è·‘å›å®¶é‡æ–°ç¿»æ‰¾ã€‚

KMPï¼šä½ æå‰åœ¨é’¥åŒ™ä¸Šåˆ»äº†æ ‡è®°ï¼ŒçŸ¥é“ã€Œé”™äº†å¯ä»¥ç›´æ¥è·³è¿‡å“ªäº›ä¸ç”¨è¯•çš„ã€ï¼ŒèŠ‚çœäº†æ¥å›è·‘çš„æ—¶é—´ã€‚

ä¸€å¥è¯æ€»ç»“ï¼š
KMP å°±æ˜¯åˆ©ç”¨ã€Œè‡ªå·±å’Œè‡ªå·±é‡å¤çš„è§„å¾‹ã€ï¼Œå‡å°‘æ²¡å¿…è¦çš„é‡å¤æ£€æŸ¥ã€‚
*/
class Solution {
public:
    int strStr(string haystack, string needle) {
        if (needle.empty()) return 0; // ç©º needle è¿”å› 0
        int n = haystack.size(), m = needle.size();
        if (m > n) return -1; // needle å¤ªé•¿
        
        // æ­¥éª¤ 1ï¼šæ„å»º LPS è¡¨
        vector<int> lps(m, 0); // LPS æ•°ç»„ï¼Œç±»ä¼¼èƒ½é‡æ¨¡å¼è¡¨
        int len = 0, j = 1; // len æ˜¯å½“å‰æœ€é•¿å‰ç¼€åç¼€é•¿åº¦
        while (j < m) {
            if (needle[j] == needle[len]) {
                lps[j++] = ++len; // å‰ç¼€åç¼€åŒ¹é…ï¼Œlen å¢åŠ 
            } else if (len > 0) {
                len = lps[len - 1]; // å›é€€åˆ°ä¸Šä¸€ä¸ªåŒ¹é…
            } else {
                lps[j++] = 0; // æ— åŒ¹é…ï¼Œlps[j] = 0
            }
        }
        
        // æ­¥éª¤ 2ï¼šKMP åŒ¹é…
        int i = 0, k = 0; // i æŒ‡å‘ haystackï¼Œk æŒ‡å‘ needle
        while (i < n) {
            if (haystack[i] == needle[k]) {
                i++; k++; // åŒ¹é…ï¼Œç»§ç»­å‰è¿›
                if (k == m) return i - m; // æ‰¾åˆ°å®Œæ•´åŒ¹é…
            } else if (k > 0) {
                k = lps[k - 1]; // ä¸åŒ¹é…ï¼Œè·³åˆ° lps[k-1]
            } else {
                i++; // k=0ï¼Œhaystack å‰è¿›
            }
        }
        return -1; // æ— åŒ¹é…
    }
};
